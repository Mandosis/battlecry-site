/*! battlecry-site 2016-05-13 */
var app=angular.module("battlecryApp",["ngRoute","angular-loading-bar","chart.js"]);app.config(["ChartJsProvider",function(a){a.setOptions({chartColors:["#FF5252","#FF8A80"],responsive:!1}),a.setOptions("line",{datasetFill:!1}),a.setOptions("doughnut",{chartColors:["#FF3333","#2222FF"]})}]),app.controller("HeadController",["HeadService",function(a){var b=this;b.tags=a.tags}]),app.controller("AppController",["UserService",function(a){var b=this;b.user=a.user,a.isAuthenticated(function(a,b){console.log(a)})}]),app.controller("HomeController",["HeadService","UserService","cfpLoadingBar","$timeout",function(a,b,c,d){var e=this;a.title("Home"),b.isAuthenticated(function(){}),e.startLoad=function(){c.start()},e.completeLoad=function(){c.complete()},e.startLoad(),e.fakeIntro=!0,d(function(){e.completeLoad(),e.fakeIntro=!1},1250)}]),app.controller("CommunityController",["HeadService","CommunityService","UserService","cfpLoadingBar","$timeout","$location",function(a,b,c,d,e,f){var g=this;g.data=b.data,g.searchInput="",g.searchError="",a.title("Community"),c.isAuthenticated(function(){}),g.search=function(){console.log("searching"),b.search(g.searchInput,function(a){1==a?(g.searchError="",f.path("/player/"+g.searchInput)):g.searchError="Player not found"})},b.stats(),g.kdLabels=["Kills","Deaths"],g.kdOptions={title:{text:"Kills / Deaths",display:!0}},g.wlLabels=["Wins","Losses"],g.startLoad=function(){d.start()},g.completeLoad=function(){d.complete()},g.startLoad(),g.fakeIntro=!0,e(function(){g.completeLoad(),g.fakeIntro=!1},1250)}]),app.controller("ErrorController",["HeadService","UserService","cfpLoadingBar","$timeout",function(a,b,c,d){var e=this;a.title("404"),b.isAuthenticated(function(){}),e.startLoad=function(){c.start()},e.completeLoad=function(){c.complete()},e.startLoad(),e.fakeIntro=!0,d(function(){e.completeLoad(),e.fakeIntro=!1},1250)}]),app.controller("LoginController",["HeadService","cfpLoadingBar","$timeout","UserService","$routeParams","$location","$templateCache",function(a,b,c,d,e,f,g){var h=this;h.username="",h.password="",h.error="",g.removeAll(),a.title("Login"),d.isAuthenticated(function(){}),h.login=function(){d.login(h.username,h.password,function(a){a.success?(f.path("/"),d.isAuthenticated(function(a,b){console.log(a)})):h.error="Username or password incorrect"})},h.startLoad=function(){b.start()},h.completeLoad=function(){b.complete()},h.startLoad(),h.fakeIntro=!0,c(function(){h.completeLoad(),h.fakeIntro=!1},1250)}]),app.controller("RegisterController",["HeadService","cfpLoadingBar","$timeout","UserService","$routeParams","$location","$templateCache","$location",function(a,b,c,d,e,f,g,f){var h=this;h.username="",h.password="",h.passwordConfrim="",h.errors=[],g.removeAll(),a.title("Register"),d.isAuthenticated(function(a){1==a&&f.path("/")}),h.register=function(){console.log("register clicked"),d.register(h.username,h.password,h.passwordConfirm,function(a,b){if(1==a)f.path("/");else{for(var c=!0,d=0;d<h.errors.length;d++)if(h.errors[d]==b)return void(c=!1);1==c&&h.errors.push(b)}})},h.startLoad=function(){b.start()},h.completeLoad=function(){b.complete()},h.startLoad(),h.fakeIntro=!0,c(function(){h.completeLoad(),h.fakeIntro=!1},1250)}]),app.controller("LogoutController",["HeadService","cfpLoadingBar","$timeout","UserService","$routeParams","$location","$templateCache",function(a,b,c,d,e,f,g){var h=this;g.removeAll(),a.title("Logout"),d.isAuthenticated(function(a){1==a?d.logout(function(){d.isAuthenticated(function(a,b){console.log(a),f.path("/")})}):f.path("/")}),h.startLoad=function(){b.start()},h.completeLoad=function(){b.complete()},h.startLoad(),h.fakeIntro=!0,c(function(){h.completeLoad(),h.fakeIntro=!1},1250)}]),app.controller("PlayerController",["HeadService","UserService","$http","cfpLoadingBar","$timeout","ProfileService","$routeParams",function(a,b,c,d,e,f,g){var h=this;h.data=f.data,a.title(g.username),b.isAuthenticated(function(){}),f.profile(g.username),f.stats(g.username),h.startLoad=function(){d.start()},h.completeLoad=function(){d.complete()},h.startLoad(),h.fakeIntro=!0,e(function(){h.completeLoad(),h.fakeIntro=!1},1250)}]),app.controller("ProfileController",["HeadService","UserService","$http","cfpLoadingBar","$timeout","ProfileService","$routeParams","$templateCache",function(a,b,c,d,e,f,g,h){var i=this;i.data=f.data,h.removeAll(),a.title(404),i.kdLabels=["Kills","Deaths"],i.kdOptions={title:{text:"Kills / Deaths",display:!0}},i.wlLabels=["Won","Lost"],i.wlOptions={title:{text:"Won / Lost",display:!0}},b.isAuthenticated(function(b,c){a.title(c.user.username),f.profile(c.user.username),f.stats(c.user.username)}),i.startLoad=function(){d.start()},i.completeLoad=function(){d.complete()},i.startLoad(),i.fakeIntro=!0,e(function(){i.completeLoad(),i.fakeIntro=!1},1250)}]),app.controller("EditController",["HeadService","UserService","$http","cfpLoadingBar","$timeout","ProfileService","$routeParams","$templateCache",function(a,b,c,d,e,f,g,h){var i=this;i.data=f.data,h.removeAll(),a.title(404),b.isAuthenticated(function(b,c){a.title(c.user.username),f.profile(c.user.username),f.stats(c.user.username)}),i.startLoad=function(){d.start()},i.completeLoad=function(){d.complete()},i.startLoad(),i.fakeIntro=!0,e(function(){i.completeLoad(),i.fakeIntro=!1},1250)}]),app.config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"/app/view/home",controller:"HomeController",controllerAs:"home"}).when("/community",{templateUrl:"/app/view/community",controller:"CommunityController",controllerAs:"community"}).when("/about",{templateUrl:"/app/view/about",controller:"AboutController",controllerAs:"about"}).when("/player/:username",{templateUrl:function(a){return"/app/view/player/"+a.username},controller:"PlayerController",controllerAs:"player"}).when("/profile",{templateUrl:"/app/view/profile",controller:"ProfileController",controllerAs:"profile"}).when("/profile/edit",{templateUrl:"/app/view/profile/edit",controller:"EditController",controllerAs:"edit"}).when("/login",{templateUrl:"/app/view/login",controller:"LoginController",controllerAs:"login"}).when("/logout",{templateUrl:"/app/view/logout",controller:"LogoutController",controllerAs:"logout"}).when("/register",{templateUrl:"/app/view/register",controller:"RegisterController",controllerAs:"register"}).otherwise({templateUrl:"/app/view/404",controller:"ErrorController",controllerAs:"error"}),b.html5Mode(!0)}]),app.factory("HeadService",function(){var a={},b=function(b){a.title=b+" | Battlecry"};return{tags:a,title:b}}),app.factory("ProfileService",["$http",function(a){var b={},c=function(c){a.get("/app/v1/players/"+c).then(function(a){a.data.joined=moment(a.data.joined).calendar(),b.account=a.data})},d=function(c){a.get("/app/v1/players/"+c+"/stats").then(function(a){b.stats=a.data,b.stats.overall.kdChart=[b.stats.overall.kills,b.stats.overall.deaths],b.stats.overall.wlChart=[b.stats.overall.won,b.stats.overall.lost],b.stats.conquest.kdChart=[b.stats.conquest.kills,b.stats.conquest.deaths],b.stats.conquest.wlChart=[b.stats.conquest.won,b.stats.conquest.lost],b.stats.teamDeathMatch.kdChart=[b.stats.teamDeathMatch.kills,b.stats.teamDeathMatch.deaths],b.stats.teamDeathMatch.wlChart=[b.stats.teamDeathMatch.won,b.stats.teamDeathMatch.lost],b.stats.freeForAll.kdChart=[b.stats.freeForAll.kills,b.stats.freeForAll.deaths]})};return{data:b,profile:c,stats:d}}]),app.factory("UserService",["$http",function(a){var b={},c=function(b,c,d){var e={username:b,password:c};a.post("/app/v1/login/",e).then(function(a){d(a.data)},function(a){d({success:!1,message:"Username or password incorrect"})})},d=function(b,c,d,e){if(c==d){var f={username:b,password:c,passwordConfirm:d};a.post("/app/v1/register",f).then(function(a){e(!0)},function(a){409==a.status?e(!1,"Username taken"):e(!1,"Internal error")})}else e(!1,"Passwords are different")},e=function(c){a.get("/app/v1/logout").then(function(a){b.data={},c()})},f=function(c){a.get("/app/v1/auth").then(function(a){1==a.data.success?(b.data=a.data.user,c(!0,a.data)):(b.data={},c(!1))})};return{user:b,login:c,logout:e,register:d,isAuthenticated:f}}]),app.factory("CommunityService",["$http",function(a){var b={},c=function(){a.get("/app/v1/community/stats").then(function(a){b.stats=a.data.data,b.stats.kdChart=[b.stats.kills,b.stats.deaths],b.stats.wlChart=[b.stats.won,b.stats.lost]})},d=function(b,c){a.get("/app/v1/community/search/"+b).then(function(a){c(!0)},function(a){c(!1)})};return{data:b,stats:c,search:d}}]);